#!/usr/bin/env bash
# This hook is run after a new virtualenv is activated.
source "${WORKON_HOME}/env_preinit"

# CREATE INSTANCE FILESYSTEM LAYOUT
load_praxon "Install" "create-instance-filesystem"

# PROVISION VIRON
load_praxon "Install" "provision-viron"

# WRITE THE PASSWORD
load_praxon "Install" "password-write"

# PIP-INSTALL EVERYTHING
load_praxon "Install" "provision-cheeseshop"

# INSTALL SOLR
load_praxon "Install" "provision-solr-instance"

# PRE-TEMPLATE FILES
load_praxon "Install" "project-template-preinit"

# GENERATE PROJECT TEMPLATE
load_praxon "Install" "project-template"

# POST-TEMPLATE FILES
load_praxon "Install" "project-template-postinit"

# PROJECT-LOCAL OPENCV
#load_praxon "Install" "provision-opencv-venv"

# GET RID OF THIS SHIT
echo "+ Trashing installation artifacts ..."
vremove pysqlite2-doc
vremove restkit
vremove socketpool

# CONFIGURE DEV-ENVIRONMENT FUNCTIONS
load_praxon "Library" "88-postinit"

# INITIALIZE ALL THE DJANGO THINGS
load_praxon "Install" "initialize-django-instance"

# SCHEMATIZE SOLR (using django-haystack)
# AND LINK XML CONFIGS INTO etc/
load_praxon "Install" "create-solr-schema-and-etc-links"

echo "+ Cleaning up ..."
cd $VIRTUAL_ENV

# SET UP GIT
load_praxon "Install" "initialize-venv-git-repo"

